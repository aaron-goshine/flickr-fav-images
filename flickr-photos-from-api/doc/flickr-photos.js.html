<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: flickr-photos.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: flickr-photos.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>(function (win) {
  /**
    * @const COLUMNS - number of columns for layout
    * @private
    */
  var COLUMNS = 3;
  /** @const TAGS - tags to filter api results
    * @private
    */
  var TAGS = 'london';

  /**
    * flickrPhotos namespace
    * @namespace flickrPhotos
    */
  win.flickrPhotos = {};

  /** This function is used to generate classes to lable each respective colums
    * @namespace flickrPhotos
    * @function flickrPhotos.generateColClass
    * @param {number} index - The index of the current item
    * @param {number} cols - The number of colomns in the current grid
    * @return {string} class name
    */
  win.flickrPhotos.generateColClass = function (index, cols) {
    return 'col-' + (Math.floor(index % cols) + 1);
  };

  /**
    * This is a localstorage service wrapper
    * @namespace flickrStore
    */

  win.flickrStore = {

    /**
      * Retrieves values from the storage by key
      * @namespace flickrStore
      * @function  flickrStore.getSelectedByKey
      * @param {string} key - The key to query
      * @return {boolean}
      */
    getSelectedByKey: function (key) {
      return localStorage.getItem(key + '_selected');
    },

    /**
      * Create or update an existing entry that matches the key.
      * This method will also remove an entry form the storage if the
      * param value is falsey
      * @namespace flickrStore
      * @function  flickStore.setSelectedByKey
      * @param {string} key - The key to query
      * @param {boolean} value - The new value to be updated on the store
      */
    setSelectedByKey: function (key, value) {
      if (typeof key === 'string' && typeof value === 'boolean') {
        if (value) {
          localStorage.setItem(key + '_selected', value);
        } else {
          localStorage.removeItem(key + '_selected');
        }
      }
    }
  };

  /**
    * This method is used to generate the DOM elements for each postcard view
    * @namespace flickrPhotos
    * @function flickrPhotos.generateView
    * @param {object} model - A model to populate the postcard item
    * @param {number} index - This a number representing the index of data
    * colloection from which this model is a part of
    */
  win.flickrPhotos.generateView = function (model, index) {
    var postcard = document.createElement('div');
    var image = document.createElement('img');
    var colClass = win.flickrPhotos.generateColClass(index, COLUMNS);
    var idHash = CryptoJS.MD5(model.description).toString();
    var isSelected = win.flickrStore.getSelectedByKey(idHash);

    image.setAttribute('id', idHash);
    image.setAttribute('src', model.media.m);
    image.setAttribute('data-url', model.link);
    image.setAttribute('alt', model.title);

    if (isSelected === 'true') {
      image.addClassName('selected');
    };

    postcard.addClassName('postcard').addClassName(colClass).appendChild(image);
    return postcard;
  };

  /*
    * The orginal callback supplied as a part of the starting
    * files with a few scope changes, to make the callback accessable outside
    * of the closure, the jsonp response need access
    */

  /**
    * The callback implemented to process data returned form the api
    * @namespace flickrPhotos
    * @callback flickrPhotos.cb
    * @param {object} data - The response data expected from the api.
    */
  win.flickrPhotos.cb = function (data) {
    var collection = data.items;
    var display = document.getElementById('display');
    for (var i = 0; i &lt; collection.length; i++) {
      var view = win.flickrPhotos.generateView(collection[i], i);
      display.appendChild(view);
    }

    display.addEventListener('click', win.flickrPhotos.clickHandler, true);
    display.addEventListener('dblclick', win.flickrPhotos.dblclickHandler, true);
  };

  /**
    * Click event handler.
    * @namespace flickrPhotos
    * @function flickrPhotos.clickHandler
    * @param {event} - The click event handler for each postcard image
    * @listens element:click~event
    */
  win.flickrPhotos.clickHandler = function (event) {
    var element = event.target;
    if (element.tagName === 'IMG') {
      var id = element.getAttribute('id');
      element.toggleClassName('selected');
      win.flickrStore.setSelectedByKey(id, element.hasClassName('selected'));
    }
  };

  /**
    * Double Click event handler.
    * @namespace flickrPhotos
    * @function flickrPhotos.dblclickHandler
    * @param {event} - The dblclick event handler for each postcard image
    * @listens element:dblclick~event
    *
    */
  win.flickrPhotos.dblclickHandler = function (event) {
    var element = event.target;
    if (element.tagName === 'IMG') {
      var url = element.getAttribute('data-url');
      open(url, '_blank');
    }
  };

  /**
    * This is the main onload handler, where I dispatch the jsonP request
    * once the page is loaded, this will give some control over the page
    * rendering of the page.
    * @function
    * @param {event} - The onload event of window is availablel as param
    *
    */
  win.flickrPhotos.onload = function (event) {
    var script = document.createElement('script');
    script.setAttribute('id', 'flicker-api');
    script.src = 'http://api.flickr.com/services/feeds/photos_public.gne?format=json&jsoncallback=window.flickrPhotos.cb&tags=' + TAGS;
    document.head.appendChild(script);
  };

  win.addEventListener('load', win.flickrPhotos.onload, false);
})(window);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Namespaces</h3><ul><li><a href="Element.html">Element</a></li><li><a href="flickrPhotos.html">flickrPhotos</a></li><li><a href="flickrStore.html">flickrStore</a></li><li><a href="testUtil.html">testUtil</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a> on Thu Dec 24 2015 14:05:33 GMT-0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
